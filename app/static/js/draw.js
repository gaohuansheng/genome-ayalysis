/**
 * Created by hsgao on 17-3-28.
 */
var graph = {
    "nodes": [{
        "color": "6",
        "group": 5,
        "name": "6_67_0.0_[6, 7]_[-0.01363279  0.0930009 ]",
        "tooltip": "<h2>Cluster 6_67_0.0_[6, 7]_[-0.01363279  0.0930009 ]</h2>C126 A503 A206 A308 A201 B515 A304"
    }, {
        "color": "7",
        "group": 10,
        "name": "7_75_0.0_[7, 5]_[ 0.06362301 -0.00650026]",
        "tooltip": "<h2>Cluster 7_75_0.0_[7, 5]_[ 0.06362301 -0.00650026]</h2>A106 B115 C323 C119 B118 A406 C127 C325"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_44_0.0_[4, 4]_[-0.16814438 -0.05625084]",
        "tooltip": "<h2>Cluster 4_44_0.0_[4, 4]_[-0.16814438 -0.05625084]</h2>B317 B215 A301"
    }, {
        "color": "3",
        "group": 5,
        "name": "3_36_0.0_[3, 6]_[-0.24540018  0.04325032]",
        "tooltip": "<h2>Cluster 3_36_0.0_[3, 6]_[-0.24540018  0.04325032]</h2>B318 B414 B418"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_47_0.0_[4, 7]_[-0.16814438  0.0930009 ]",
        "tooltip": "<h2>Cluster 4_47_0.0_[4, 7]_[-0.16814438  0.0930009 ]</h2>A405 B312 B214 A509 B313"
    }, {
        "color": "7",
        "group": 5,
        "name": "7_77_0.0_[7, 7]_[ 0.06362301  0.0930009 ]",
        "tooltip": "<h2>Cluster 7_77_0.0_[7, 7]_[ 0.06362301  0.0930009 ]</h2>A503 C121 A201"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_65_0.0_[6, 5]_[-0.01363279 -0.00650026]",
        "tooltip": "<h2>Cluster 6_65_0.0_[6, 5]_[-0.01363279 -0.00650026]</h2>A403 C423 B118 B218 C120 A307 C325"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_59_0.0_[5, 9]_[-0.09088859  0.19250207]",
        "tooltip": "<h2>Cluster 5_59_0.0_[5, 9]_[-0.09088859  0.19250207]</h2>A408 A205 A204"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_53_0.0_[5, 3]_[-0.09088859 -0.10600143]",
        "tooltip": "<h2>Cluster 5_53_0.0_[5, 3]_[-0.09088859 -0.10600143]</h2>B316 C524 A107"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_57_0.0_[5, 7]_[-0.09088859  0.0930009 ]",
        "tooltip": "<h2>Cluster 5_57_0.0_[5, 7]_[-0.09088859  0.0930009 ]</h2>B214 A402 A206 A308"
    }, {
        "color": "7",
        "group": 5,
        "name": "7_72_0.0_[7, 2]_[ 0.06362301 -0.15575201]",
        "tooltip": "<h2>Cluster 7_72_0.0_[7, 2]_[ 0.06362301 -0.15575201]</h2>C322 C324 B113 B110"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_49_0.0_[4, 9]_[-0.16814438  0.19250207]",
        "tooltip": "<h2>Cluster 4_49_0.0_[4, 9]_[-0.16814438  0.19250207]</h2>B411 A408 A205 A204"
    }, {
        "color": "3",
        "group": 5,
        "name": "3_32_0.0_[3, 2]_[-0.24540018 -0.15575201]",
        "tooltip": "<h2>Cluster 3_32_0.0_[3, 2]_[-0.24540018 -0.15575201]</h2>B216 C424 A108 C521"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_68_0.0_[6, 8]_[-0.01363279  0.14275149]",
        "tooltip": "<h2>Cluster 6_68_0.0_[6, 8]_[-0.01363279  0.14275149]</h2>A206 A209 B515"
    }, {
        "color": "8",
        "group": 5,
        "name": "8_82_0.0_[8, 2]_[ 0.1408788  -0.15575201]",
        "tooltip": "<h2>Cluster 8_82_0.0_[8, 2]_[ 0.1408788  -0.15575201]</h2>C322 A105 B116 A309"
    }, {
        "color": "7",
        "group": 5,
        "name": "7_73_0.0_[7, 3]_[ 0.06362301 -0.10600143]",
        "tooltip": "<h2>Cluster 7_73_0.0_[7, 3]_[ 0.06362301 -0.10600143]</h2>C319 C324 B113 A101 C123 C124"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_56_0.0_[5, 6]_[-0.09088859  0.04325032]",
        "tooltip": "<h2>Cluster 5_56_0.0_[5, 6]_[-0.09088859  0.04325032]</h2>A402 A308 A202"
    }, {
        "color": "5",
        "group": 10,
        "name": "5_55_0.0_[5, 5]_[-0.09088859 -0.00650026]",
        "tooltip": "<h2>Cluster 5_55_0.0_[5, 5]_[-0.09088859 -0.00650026]</h2>C219 B317 A409 A403 B314 B218 C120 A202"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_61_0.0_[6, 1]_[-0.01363279 -0.20550259]",
        "tooltip": "<h2>Cluster 6_61_0.0_[6, 1]_[-0.01363279 -0.20550259]</h2>B315 C321 C327 B110"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_66_0.0_[6, 6]_[-0.01363279  0.04325032]",
        "tooltip": "<h2>Cluster 6_66_0.0_[6, 6]_[-0.01363279  0.04325032]</h2>C423 B118 A308"
    }, {
        "color": "8",
        "group": 5,
        "name": "8_84_0.0_[8, 4]_[ 0.1408788  -0.05625084]",
        "tooltip": "<h2>Cluster 8_84_0.0_[8, 4]_[ 0.1408788  -0.05625084]</h2>B310 C323 C320 C125 B114"
    }, {
        "color": "7",
        "group": 5,
        "name": "7_76_0.0_[7, 6]_[ 0.06362301  0.04325032]",
        "tooltip": "<h2>Cluster 7_76_0.0_[7, 6]_[ 0.06362301  0.04325032]</h2>B518 B118 A203"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_62_0.0_[6, 2]_[-0.01363279 -0.15575201]",
        "tooltip": "<h2>Cluster 6_62_0.0_[6, 2]_[-0.01363279 -0.15575201]</h2>C222 B217 C321 C324 C327 B110 A207"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_42_0.0_[4, 2]_[-0.16814438 -0.15575201]",
        "tooltip": "<h2>Cluster 4_42_0.0_[4, 2]_[-0.16814438 -0.15575201]</h2>C223 C224 C420 C226 A108 C521"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_63_0.0_[6, 3]_[-0.01363279 -0.10600143]",
        "tooltip": "<h2>Cluster 6_63_0.0_[6, 3]_[-0.01363279 -0.10600143]</h2>C222 C319 C324 A109 A104"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_48_0.0_[4, 8]_[-0.16814438  0.14275149]",
        "tooltip": "<h2>Cluster 4_48_0.0_[4, 8]_[-0.16814438  0.14275149]</h2>B312 B412 B417 B212 A408 A205"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_58_0.0_[5, 8]_[-0.09088859  0.14275149]",
        "tooltip": "<h2>Cluster 5_58_0.0_[5, 8]_[-0.09088859  0.14275149]</h2>A506 A206 B415 A209 A408 A205"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_51_0.0_[5, 1]_[-0.09088859 -0.20550259]",
        "tooltip": "<h2>Cluster 5_51_0.0_[5, 1]_[-0.09088859 -0.20550259]</h2>C220 C426 C321 C327"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_52_0.0_[5, 2]_[-0.09088859 -0.15575201]",
        "tooltip": "<h2>Cluster 5_52_0.0_[5, 2]_[-0.09088859 -0.15575201]</h2>C420 C321 C226 C327 A107"
    }, {
        "color": "8",
        "group": 5,
        "name": "8_86_0.0_[8, 6]_[ 0.1408788   0.04325032]",
        "tooltip": "<h2>Cluster 8_86_0.0_[8, 6]_[ 0.1408788   0.04325032]</h2>B518 A305 A203"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_43_0.0_[4, 3]_[-0.16814438 -0.10600143]",
        "tooltip": "<h2>Cluster 4_43_0.0_[4, 3]_[-0.16814438 -0.10600143]</h2>C223 B111 A102 C524"
    }, {
        "color": "6",
        "group": 5,
        "name": "6_64_0.0_[6, 4]_[-0.01363279 -0.05625084]",
        "tooltip": "<h2>Cluster 6_64_0.0_[6, 4]_[-0.01363279 -0.05625084]</h2>A403 C122 B218 A307 A104 A302 B117"
    }, {
        "color": "7",
        "group": 10,
        "name": "7_74_0.0_[7, 4]_[ 0.06362301 -0.05625084]",
        "tooltip": "<h2>Cluster 7_74_0.0_[7, 4]_[ 0.06362301 -0.05625084]</h2>B115 C323 C122 C320 B114 B117 A103 C123"
    }, {
        "color": "8",
        "group": 5,
        "name": "8_85_0.0_[8, 5]_[ 0.1408788  -0.00650026]",
        "tooltip": "<h2>Cluster 8_85_0.0_[8, 5]_[ 0.1408788  -0.00650026]</h2>A106 C323 A305 C125"
    }, {
        "color": "4",
        "group": 5,
        "name": "4_45_0.0_[4, 5]_[-0.16814438 -0.00650026]",
        "tooltip": "<h2>Cluster 4_45_0.0_[4, 5]_[-0.16814438 -0.00650026]</h2>C219 B317 B314 C326"
    }, {
        "color": "5",
        "group": 5,
        "name": "5_54_0.0_[5, 4]_[-0.09088859 -0.05625084]",
        "tooltip": "<h2>Cluster 5_54_0.0_[5, 4]_[-0.09088859 -0.05625084]</h2>B317 A409 A403 B218 A303 A302"
    }],
    "links": [{"source": 0, "target": 5, "value": 1}, {"source": 0, "target": 9, "value": 1}, {
        "source": 0,
        "target": 13,
        "value": 1
    }, {"source": 0, "target": 16, "value": 1}, {"source": 0, "target": 19, "value": 1}, {
        "source": 0,
        "target": 26,
        "value": 1
    }, {"source": 1, "target": 6, "value": 1}, {"source": 1, "target": 19, "value": 1}, {
        "source": 1,
        "target": 20,
        "value": 1
    }, {"source": 1, "target": 21, "value": 1}, {"source": 1, "target": 32, "value": 1}, {
        "source": 1,
        "target": 33,
        "value": 1
    }, {"source": 2, "target": 17, "value": 1}, {"source": 2, "target": 34, "value": 1}, {
        "source": 2,
        "target": 35,
        "value": 1
    }, {"source": 4, "target": 9, "value": 1}, {"source": 4, "target": 25, "value": 1}, {
        "source": 6,
        "target": 17,
        "value": 1
    }, {"source": 6, "target": 19, "value": 1}, {"source": 6, "target": 21, "value": 1}, {
        "source": 6,
        "target": 31,
        "value": 1
    }, {"source": 6, "target": 35, "value": 1}, {"source": 7, "target": 11, "value": 1}, {
        "source": 7,
        "target": 25,
        "value": 1
    }, {"source": 7, "target": 26, "value": 1}, {"source": 9, "target": 13, "value": 1}, {
        "source": 9,
        "target": 16,
        "value": 1
    }, {"source": 9, "target": 19, "value": 1}, {"source": 9, "target": 26, "value": 1}, {
        "source": 10,
        "target": 14,
        "value": 1
    }, {"source": 10, "target": 15, "value": 1}, {"source": 10, "target": 18, "value": 1}, {
        "source": 10,
        "target": 22,
        "value": 1
    }, {"source": 10, "target": 24, "value": 1}, {"source": 11, "target": 25, "value": 1}, {
        "source": 11,
        "target": 26,
        "value": 1
    }, {"source": 12, "target": 23, "value": 1}, {"source": 13, "target": 26, "value": 1}, {
        "source": 15,
        "target": 22,
        "value": 1
    }, {"source": 15, "target": 24, "value": 1}, {"source": 15, "target": 32, "value": 1}, {
        "source": 16,
        "target": 17,
        "value": 1
    }, {"source": 16, "target": 19, "value": 1}, {"source": 8, "target": 28, "value": 1}, {
        "source": 8,
        "target": 30,
        "value": 1
    }, {"source": 18, "target": 22, "value": 1}, {"source": 18, "target": 27, "value": 1}, {
        "source": 18,
        "target": 28,
        "value": 1
    }, {"source": 25, "target": 26, "value": 1}, {"source": 20, "target": 32, "value": 1}, {
        "source": 20,
        "target": 33,
        "value": 1
    }, {"source": 21, "target": 29, "value": 1}, {"source": 22, "target": 24, "value": 1}, {
        "source": 22,
        "target": 27,
        "value": 1
    }, {"source": 22, "target": 28, "value": 1}, {"source": 23, "target": 28, "value": 1}, {
        "source": 23,
        "target": 30,
        "value": 1
    }, {"source": 24, "target": 31, "value": 1}, {"source": 19, "target": 21, "value": 1}, {
        "source": 27,
        "target": 28,
        "value": 1
    }, {"source": 17, "target": 31, "value": 1}, {"source": 17, "target": 34, "value": 1}, {
        "source": 17,
        "target": 35,
        "value": 1
    }, {"source": 29, "target": 33, "value": 1}, {"source": 31, "target": 32, "value": 1}, {
        "source": 31,
        "target": 35,
        "value": 1
    }, {"source": 32, "target": 33, "value": 1}, {"source": 34, "target": 35, "value": 1}]
};
var search_map = {
    'A202': [16, 17],
    'A408': [7, 11, 25, 26],
    'B415': [26],
    'B312': [4, 25],
    'B215': [2],
    'C226': [23, 28],
    'C326': [34],
    'A101': [15],
    'A301': [2],
    'A403': [6, 17, 31, 35],
    'A106': [1, 33],
    'C319': [15, 24],
    'B316': [8],
    'C521': [12, 23],
    'A104': [24, 31],
    'A204': [7, 11],
    'A205': [7, 11, 25, 26],
    'A503': [0, 5],
    'C123': [15, 32],
    'A201': [0, 5],
    'B217': [22],
    'B314': [17, 34],
    'B418': [3],
    'B110': [10, 18, 22],
    'A509': [4],
    'C120': [6, 17],
    'C426': [27],
    'B417': [25],
    'C126': [0],
    'C124': [15],
    'C320': [20, 32],
    'B115': [1, 32],
    'C122': [31, 32],
    'B411': [11],
    'C323': [1, 20, 32, 33],
    'B114': [20, 32],
    'B216': [12],
    'A308': [0, 9, 16, 19],
    'A103': [32],
    'C125': [20, 33],
    'A102': [30],
    'C321': [18, 22, 27, 28],
    'C219': [17, 34],
    'B518': [21, 29],
    'A109': [24],
    'B310': [20],
    'C524': [8, 30],
    'C322': [10, 14],
    'C223': [23, 30],
    'A309': [14],
    'B118': [1, 6, 19, 21],
    'A409': [17, 35],
    'C324': [10, 15, 22, 24],
    'B317': [2, 17, 34, 35],
    'C423': [6, 19],
    'A307': [6, 31],
    'C424': [12],
    'A302': [31, 35],
    'C121': [5],
    'A303': [35],
    'B214': [4, 9],
    'B116': [14],
    'A506': [26],
    'C327': [18, 22, 27, 28],
    'B111': [30],
    'A207': [22],
    'B113': [10, 15],
    'B117': [31, 32],
    'C420': [23, 28],
    'C119': [1],
    'B315': [18],
    'A405': [4],
    'A402': [9, 16],
    'A305': [29, 33],
    'B515': [0, 13],
    'A105': [14],
    'B412': [25],
    'C222': [22, 24],
    'C325': [1, 6],
    'C127': [1],
    'A209': [13, 26],
    'B218': [6, 17, 31, 35],
    'B212': [25],
    'C224': [23],
    'B318': [3],
    'B414': [3],
    'A203': [21, 29],
    'A206': [0, 9, 13, 26],
    'C220': [27],
    'A107': [8, 28],
    'A406': [1],
    'A304': [0],
    'B313': [4],
    'A108': [12, 23]
};
var filter_list = {
    "Week": ["w0", "w1", "w2", "w3", "w4"],
    "Time": ["20150825", "20150901", "20150907", "20150915", "20150921"],
    "Individual": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27],
    "Group": ['A', 'B', 'C'],
    "Treatment": ["saline", "Vehicle", "CK"]
};
var filter_map = {
    'w1': ['A201', 'A202', 'A203', 'A204', 'A205', 'A206', 'A207', 'A208', 'A209', 'B210', 'B211', 'B212', 'B213',
        'B214', 'B215', 'B216', 'B217', 'B218', 'C219', 'C220', 'C221', 'C222', 'C223', 'C224', 'C225', 'C226',
        'C227'],
    '19': ['C119', 'C219', 'C319'],
    'w0': ['A101', 'A102', 'A103', 'A104', 'A105', 'A106', 'A107', 'A108', 'A109', 'B110', 'B111', 'B112', 'B113',
        'B114', 'B115', 'B116', 'B117', 'B118', 'C119', 'C120', 'C121', 'C122', 'C123', 'C124', 'C125', 'C126',
        'C127'],
    '11': ['B111', 'B211', 'B311', 'B411'],
    '7': ['A107', 'A207', 'A307'],
    '20150901': ['A201', 'A202', 'A203', 'A204', 'A205', 'A206', 'A207', 'A208', 'A209', 'B210', 'B211', 'B212', 'B213',
        'B214', 'B215', 'B216', 'B217', 'B218', 'C219', 'C220', 'C221', 'C222', 'C223', 'C224', 'C225', 'C226',
        'C227'],
    '8': ['A108', 'A208', 'A308', 'A408'],
    '20150921': ['A503', 'A506', 'A509', 'B512', 'B515', 'B518', 'C521', 'C524', 'C527'],
    '16': ['B116', 'B216', 'B316'],
    '1': ['A101', 'A201', 'A301'],
    '27': ['C127', 'C227', 'C327', 'C427', 'C527'],
    '23': ['C123', 'C223', 'C323', 'C423'],
    '6': ['A106', 'A206', 'A306', 'A406', 'A506'],
    '20150915': ['A402', 'A403', 'A405', 'A406', 'A408', 'A409', 'B411', 'B412', 'B414', 'B415', 'B417', 'B418', 'C420',
        'C421', 'C423', 'C424', 'C426', 'C427'],
    'w3': ['A402', 'A403', 'A405', 'A406', 'A408', 'A409', 'B411', 'B412', 'B414', 'B415', 'B417', 'B418', 'C420',
        'C421', 'C423', 'C424', 'C426', 'C427'],
    '17': ['B117', 'B217', 'B317', 'B417'],
    '24': ['C124', 'C224', 'C324', 'C424', 'C524'],
    'A': ['A101', 'A102', 'A103', 'A104', 'A105', 'A106', 'A107', 'A108', 'A109', 'A201', 'A202', 'A203', 'A204',
        'A205', 'A206', 'A207', 'A208', 'A209', 'A301', 'A302', 'A303', 'A304', 'A305', 'A306', 'A307', 'A308',
        'A309', 'A402', 'A403', 'A405', 'A406', 'A408', 'A409', 'A503', 'A506', 'A509'],
    '10': ['B110', 'B210', 'B310'],
    '18': ['B118', 'B218', 'B318', 'B418', 'B518'],
    '20150907': ['A301', 'A302', 'A303', 'A304', 'A305', 'A306', 'A307', 'A308', 'A309', 'B310', 'B311', 'B312', 'B313',
        'B314', 'B315', 'B316', 'B317', 'B318', 'C319', 'C320', 'C321', 'C322', 'C323', 'C324', 'C325', 'C326',
        'C327'],
    'Vehicle': ['B110', 'B111', 'B112', 'B113', 'B114', 'B115', 'B116', 'B117', 'B118', 'B210', 'B211', 'B212', 'B213',
        'B214', 'B215', 'B216', 'B217', 'B218', 'B310', 'B311', 'B312', 'B313', 'B314', 'B315', 'B316', 'B317',
        'B318', 'B411', 'B412', 'B414', 'B415', 'B417', 'B418', 'B512', 'B515', 'B518'],
    '9': ['A109', 'A209', 'A309', 'A409', 'A509'],
    '13': ['B113', 'B213', 'B313'],
    '14': ['B114', 'B214', 'B314', 'B414'],
    '22': ['C122', 'C222', 'C322'],
    'w4': ['A503', 'A506', 'A509', 'B512', 'B515', 'B518', 'C521', 'C524', 'C527'],
    '20150825': ['A101', 'A102', 'A103', 'A104', 'A105', 'A106', 'A107', 'A108', 'A109', 'B110', 'B111', 'B112', 'B113',
        'B114', 'B115', 'B116', 'B117', 'B118', 'C119', 'C120', 'C121', 'C122', 'C123', 'C124', 'C125', 'C126',
        'C127'],
    '15': ['B115', 'B215', 'B315', 'B415', 'B515'],
    'w2': ['A301', 'A302', 'A303', 'A304', 'A305', 'A306', 'A307', 'A308', 'A309', 'B310', 'B311', 'B312', 'B313',
        'B314', 'B315', 'B316', 'B317', 'B318', 'C319', 'C320', 'C321', 'C322', 'C323', 'C324', 'C325', 'C326',
        'C327'],
    '5': ['A105', 'A205', 'A305', 'A405'],
    '12': ['B112', 'B212', 'B312', 'B412', 'B512'],
    '3': ['A103', 'A203', 'A303', 'A403', 'A503'],
    '2': ['A102', 'A202', 'A302', 'A402'],
    '4': ['A104', 'A204', 'A304'],
    '25': ['C125', 'C225', 'C325'],
    'saline': ['A101', 'A102', 'A103', 'A104', 'A105', 'A106', 'A107', 'A108', 'A109', 'A201', 'A202', 'A203', 'A204',
        'A205', 'A206', 'A207', 'A208', 'A209', 'A301', 'A302', 'A303', 'A304', 'A305', 'A306', 'A307', 'A308',
        'A309', 'A402', 'A403', 'A405', 'A406', 'A408', 'A409', 'A503', 'A506', 'A509'],
    'C': ['C119', 'C120', 'C121', 'C122', 'C123', 'C124', 'C125', 'C126', 'C127', 'C219', 'C220', 'C221', 'C222',
        'C223', 'C224', 'C225', 'C226', 'C227', 'C319', 'C320', 'C321', 'C322', 'C323', 'C324', 'C325', 'C326',
        'C327', 'C420', 'C421', 'C423', 'C424', 'C426', 'C427', 'C521', 'C524', 'C527'],
    '20': ['C120', 'C220', 'C320', 'C420'],
    'CK': ['C119', 'C120', 'C121', 'C122', 'C123', 'C124', 'C125', 'C126', 'C127', 'C219', 'C220', 'C221', 'C222',
        'C223', 'C224', 'C225', 'C226', 'C227', 'C319', 'C320', 'C321', 'C322', 'C323', 'C324', 'C325', 'C326',
        'C327', 'C420', 'C421', 'C423', 'C424', 'C426', 'C427', 'C521', 'C524', 'C527'],
    '21': ['C121', 'C221', 'C321', 'C421', 'C521'],
    '26': ['C126', 'C226', 'C326', 'C426'],
    'B': ['B110', 'B111', 'B112', 'B113', 'B114', 'B115', 'B116', 'B117', 'B118', 'B210', 'B211', 'B212', 'B213',
        'B214', 'B215', 'B216', 'B217', 'B218', 'B310', 'B311', 'B312', 'B313', 'B314', 'B315', 'B316', 'B317',
        'B318', 'B411', 'B412', 'B414', 'B415', 'B417', 'B418', 'B512', 'B515', 'B518']
};
var color_list = {
    0: 7,
    1: 8,
    2: 3,
    3: 3,
    4: 5,
    5: 3,
    6: 7,
    7: 3,
    8: 3,
    9: 4,
    10: 4,
    11: 4,
    12: 4,
    13: 3,
    14: 4,
    15: 6,
    16: 3,
    17: 8,
    18: 4,
    19: 3,
    20: 5,
    21: 3,
    22: 7,
    23: 6,
    24: 5,
    25: 6,
    26: 6,
    27: 4,
    28: 5,
    29: 3,
    30: 4,
    31: 7,
    32: 8,
    33: 4,
    34: 4,
    35: 6
};
var sample_count = {
    0: 7,
    1: 8,
    2: 3,
    3: 3,
    4: 5,
    5: 3,
    6: 7,
    7: 3,
    8: 3,
    9: 4,
    10: 4,
    11: 4,
    12: 4,
    13: 3,
    14: 4,
    15: 6,
    16: 3,
    17: 8,
    18: 4,
    19: 3,
    20: 5,
    21: 3,
    22: 7,
    23: 6,
    24: 5,
    25: 6,
    26: 6,
    27: 4,
    28: 5,
    29: 3,
    30: 4,
    31: 7,
    32: 8,
    33: 4,
    34: 4,
    35: 6
};
var width = document.getElementById("holder").offsetWidth,
    height = document.getElementById("holder").offsetHeight;
var color1 = d3.scale.ordinal()
    .domain(["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"])
    .range(["#FF0000", "#FF1400", "#FF2800", "#FF3c00", "#FF5000", "#FF6400", "#FF7800", "#FF8c00", "#FFa000", "#FFb400", "#FFc800", "#FFdc00", "#FFf000", "#fdff00", "#b0ff00", "#65ff00", "#17ff00", "#00ff36", "#00ff83", "#00ffd0", "#00e4ff", "#00c4ff", "#00a4ff", "#00a4ff", "#0084ff", "#0064ff", "#0044ff", "#0022ff", "#0002ff", "#0100ff", "#0300ff", "#0500ff"]);
var color2 = d3.interpolate("#01b5ff", "#fe551f");
//var color3 = d3.interpolate("")
var color = color1;
var force = d3.layout.force()
    .charge(-120)
    .linkDistance(30)
    .gravity(0.1)
    .size([width, height]);
var svg = d3.select("#holder").append("svg")
    .attr("width", width)
    .attr("height", height);

var div = d3.select("#holder").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0.0);

var divs = d3.select('#holder').append('div')
    .attr('class', 'divs')
    .attr('style', function (d) {
        return 'overflow: hidden; width: ' + width + 'px; height: ' + height + 'px;';
    });

force
    .nodes(graph.nodes)
    .links(graph.links)
    .start();
var link = svg.selectAll(".link")
    .data(graph.links)
    .enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function (d) {
        return Math.sqrt(d.value);
    });
var node = divs.selectAll('div')
    .data(graph.nodes)
    .enter().append('div')
    .style("background", function (d) {
        return color(d.color)
    })
    .style("box-shadow", function (d) {
        return '0px 0px 35px 2px' + color(d.color);
    })
    .on("mouseover", function (d) {
        div.transition()
            .duration(200)
            .style("opacity", 0.9);
        div.html(d.tooltip + "<br/>")
            .style("left", (d3.event.pageX - 200) + "px")
            .style("top", (d3.event.pageY - 28) + "px");
    })
    .on("mouseout", function (d) {
        div.transition()
            .duration(300)
            .style("opacity", 0);
    })
    .call(force.drag);

node.append("title")
    .text(function (d) {
        return d.name;
    });
force.on("tick", function () {
    link.attr("x1", function (d) {
        return d.source.x;
    })
        .attr("y1", function (d) {
            return d.source.y;
        })
        .attr("x2", function (d) {
            return d.target.x;
        })
        .attr("y2", function (d) {
            return d.target.y;
        });
    node.attr("cx", function (d) {
        return d.x;
    })
        .attr("cy", function (d) {
            return d.y;
        })
        .style("width", function (d) {
            return d.group * 2 + "px"
        })
        .style("height", function (d) {
            return d.group * 2 + "px"
        })
        .style("left", function (d) {
            return (d.x + 7.4) + "px"
        })
        .style("top", function (d) {
            return (d.y - d.group) + "px"
        })
});

// Search nodes
$("#search_nodes").change(function () {
    if ($(this).val() in search_map) {
        var node_index = search_map[$(this).val()];
        $("#selectedNodes").text(node_index.length);
        $("#selectedSamples").text(1);
        node.style("background", function (d) {
            if (node_index.indexOf(d.index) !== -1) {
                if (color === color1){
                    return color(1);
                }
                if (color === color2){
                    return color(1/color_list[d.index])
                }
            }
            else {
                return "#999"
            }
        })
            .style("opacity", function (d) {
                if (node_index.indexOf(d.index) !== -1) {
                    return 0.9
                }
                else {
                    return 0.4
                }
            })
    }
    else {
        $("#selectedNodes").text(36);
        node.style("background", function (d) {
            if(color === color1){
                return color(d.color)
            }
            if (color === color2){
                return color(1)
            }
        })
            .style("opacity", 0.9)
            .style("box-shadow",function (d) {
                if (color === color1){
                    return '0px 0px 35px 2px' + color(d.color);
                }
                if (color === color2){
                    return '0px 0px 35px 2px' + color(1);
                }
            })

    }
});

//node statics
$("#allNodes").text(36);
$("#selectedNodes").text(36);
$("#allSamples").text(_.size(search_map));
$("#selectedSamples").text(_.size(search_map));

// Reset
$("#filters").append("<button class='btn btn-default btn-block active' style='font-weight:700' id='reset'>Reset</button>");
// Filters
$(function () {
    // Reset事件
    $("#reset").on("click", function () {
        $("input[type=checkbox]:checked").prop("checked", '');
        node.style("opacity", 0.9)
            .style("background", function (d) {
                if (color === color1){
                    return color(d.color)
                }
                if (color === color2){
                    return color(1)
                }
            })
            .style("box-shadow",function (d) {
                if (color === color1){
                    return '0px 0px 35px 2px' + color(d.color);
                }
                if (color === color2){
                    return '0px 0px 35px 2px' + color(1);
                }
            });
        $("#selectedNodes").text(36);
        $("#selectedSamples").text(search_map.length)
    });
    // 添加元素
    for (var key in filter_list) {
        var li = $("<div></div>").attr("id", key).addClass("filter").append("<a class='dropdown'>").append("<ul style='display:none' class='list'></ul>");
        $("#filters").append(li);
        $("#" + key).find("a").text(key);

        for (var i in filter_list[key]) {
            var li2 = $("<li style='position:relative'></li>").text(filter_list[key][i]).attr("id", filter_list[key][i]).addClass("condition").append("<input type='checkbox' style='float:right;margin-right:40px'>");
            $("#" + key).find("ul").append(li2);
        }
    }

    $(".dropdown").click(function () {
        $(this).next("ul").slideToggle(500)
    });

    // Default 颜色模式
    $("#default").click(function () {
        $("#worked").text("Default");
        color = color1;
        node.style("background", function (d) {
            if (sample_count[d.index] === 0) {
                return "#999"
            }
            else {
                return color(d.color)
            }
        })
            .style("box-shadow",function(d){
                return "0px 0px 33px 2px" + color(d.color)
            })
    });

    // pct-of-select 颜色模式
    $("#pct-of-select").click(function () {
        color = color2;
        $("#worked").text("Pct-of-select");
        node.style("background", function (d) {
            if (sample_count[d.index] === 0) {
                return "#999"
            }
            else {
                return color(sample_count[d.index]/color_list[d.index])
            }
        })
            .style("box-shadow", function (d) {
                if (color === color1){
                    return "0px 0px 33px 2px" + color(d.color)
                }
                if (color === color2){
                    return "0px 0px 33px 2px " + color(sample_count[d.index]/color_list[d.index])
                }
            })
    });

    // num-of-select 颜色模式
    $("#num-of-select").click(function(){
        $("#worked").text("Num-of-select");
        //color = color3;
    });

    // 绑定事件
    $("#filters").find("input").on("change", function () {
        var l2 = [];
        sample_count = {
            0: 0,
            1: 0,
            2: 0,
            3: 0,
            4: 0,
            5: 0,
            6: 0,
            7: 0,
            8: 0,
            9: 0,
            10: 0,
            11: 0,
            12: 0,
            13: 0,
            14: 0,
            15: 0,
            16: 0,
            17: 0,
            18: 0,
            19: 0,
            20: 0,
            21: 0,
            22: 0,
            23: 0,
            24: 0,
            25: 0,
            26: 0,
            27: 0,
            28: 0,
            29: 0,
            30: 0,
            31: 0,
            32: 0,
            33: 0,
            34: 0,
            35: 0
        };
        var l =['C322', 'A408', 'C125', 'A309', 'A202', 'A303', 'C127', 'A206', 'B115', 'C123', 'C120', 'A302', 'A204', 'C223', 'C224', 'A205', 'A301', 'C426', 'A109', 'B214', 'B314', 'B310', 'B118', 'A203', 'A207', 'B313', 'B414', 'A304', 'A307', 'B417', 'C319', 'B113', 'B515', 'A104', 'B110', 'C327', 'B116', 'B215', 'A105', 'C324', 'C321', 'A403', 'A102', 'A106', 'B114', 'B218', 'C521', 'C524', 'C119', 'C226', 'B316', 'A506', 'B315', 'A305', 'A409', 'B412', 'B317', 'B117', 'A405', 'A201', 'A406', 'C126', 'C325', 'B415', 'B418', 'C423', 'C121', 'A108', 'A503', 'A101', 'B312', 'B212', 'A308', 'B318', 'B217', 'C219', 'C220', 'C326', 'A103', 'B216', 'A402', 'B518', 'C323', 'A107', 'B411', 'C424', 'C222', 'C420', 'B111', 'A209', 'C122', 'C124', 'C320', 'A509'];
        var week = [], time = [], individual = [], group = [], treatment = [];
        $("input[type=checkbox]:checked").each(function () {
            //console.log($(this).parents("li").attr("id"));
            var id2 = $(this).parents("li").attr("id");
            if ($(this).parents("div").attr("id") === 'Week') {
                week = _.union(week, filter_map[id2]);
            }
            if ($(this).parents("div").attr("id") === 'Time') {
                time = _.union(time, filter_map[id2])
            }
            if ($(this).parents("div").attr("id") === 'Individual') {
                individual = _.union(individual, filter_map[id2])
            }
            if ($(this).parents("div").attr("id") === 'Group') {
                group = _.union(group, filter_map[id2])
            }
            if ($(this).parents("div").attr("id") === 'Treatment') {
                treatment = _.union(treatment, filter_map[id2])
            }
        });

        var f = [week, time, individual, group, treatment];
        for (var i of f) {
            if (i.length) {
                l = _.intersection(l, i);
            }
        }
        for (var i of l) {
            l2 = _.union(l2, search_map[i]);
            if (search_map[i] !== undefined) {
                for (var j of search_map[i]) {
                    sample_count[j] += 1;
                }
            }

        }
        //node更新
        $("#selectedNodes").text(l2.length);
        $("#selectedSamples").text(l.length);
        // 节点变化
        node.style("background", function (d) {
            if (l2.indexOf(d.index) !== -1) {
                if (color === color1){
                    return color(d.color)
                }
                if (color === color2){
                    return color(sample_count[d.index]/color_list[d.index])
                }
            }
            else {
                return "#999";
            }
        })
            .style("box-shadow", function (d) {
                if (color === color1){
                    return "0px 0px 33px 2px" + color(d.color)
                }
                if (color === color2){
                    return "0px 0px 33px 2px " + color(sample_count[d.index]/color_list[d.index])
                }
            })
            .style("opacity", function (d) {
                if (l2.indexOf(d.index) !== -1) {
                    return 0.9;
                }
                else {
                    return 0.4;
                }
            });
    });
});